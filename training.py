
"""Untitled1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/16z-JiaznCvHoCPte8ipAfBFjbHz1FBR-
"""

import os
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import r2_score, mean_absolute_error, mean_squared_error
import joblib

def load_data():
    path = os.path.join("data", "Salary.csv")
    if os.path.exists(path):
        df = pd.read_csv(path)
    else:
        df = pd.DataFrame({
            'Experience': [1, 3, 5, 7, 9, 11, 13, 15],
            'Education_Level': ['Bachelors', 'Masters', 'PhD', 'Bachelors', 'Masters', 'PhD', 'Masters', 'PhD'],
            'Job_Role': ['Data Analyst', 'Data Scientist', 'ML Engineer', 'Software Engineer', 'Data Analyst', 'ML Engineer', 'Data Scientist', 'Software Engineer'],
            'Location': ['Delhi', 'Bangalore', 'Pune', 'Hyderabad', 'Bangalore', 'Delhi', 'Pune', 'Hyderabad'],
            'Salary': [45000, 80000, 125000, 100000, 75000, 130000, 120000, 110000]
        })
    return df

def preprocess(df):
    df = df.dropna(subset=['Salary'])
    cat_cols = df.select_dtypes(include=['object', 'category']).columns.tolist()
    df_encoded = pd.get_dummies(df, columns=cat_cols, drop_first=True)
    return df_encoded

def train_model(model_type='linear'):
    df = load_data()
    df_encoded = preprocess(df)
    X = df_encoded.drop('Salary', axis=1)
    y = df_encoded['Salary']
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    if model_type == 'linear':
        model = LinearRegression()
    else:
        model = RandomForestRegressor(n_estimators=100, random_state=42)

    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)

    metrics = {
        'R2 Score': round(r2_score(y_test, y_pred), 3),
        'MAE': round(mean_absolute_error(y_test, y_pred), 3),
        'MSE': round(mean_squared_error(y_test, y_pred), 3)
    }

    os.makedirs("models", exist_ok=True)
    joblib.dump({'model': model, 'columns': X.columns.tolist()}, os.path.join("models", "model.pkl"))

    print("Model trained successfully and saved as models/model.pkl")
    print("Performance Metrics:")
    for k, v in metrics.items():
        print(f"{k}: {v}")

if __name__ == "__main__":
    train_model(model_type='linear')